%{?systemd_requires}
%define rvc_confdir %{_sysconfdir}/rvc

%define version @PACKAGE_VERSION@
%define release 1

Name: rvc
Summary: Relaxed VPN Client command line tool
Version: %{version}
Release: %{release}%{?dist}
License: GPLv2+
URL: https://github.com/riboseinc/rvc
Group: System Environment/Daemons

Source0: rvc-%{version}.tar.gz
Source1: rvd.conf
Source2: rvd.service

BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
BuildRequires: json-c-devel openssl-devel
BuildRequires: setup >= 2.5
Requires: json-c openssl

%description
RVC is a secure CLI-based OpenVPN client for Linux/MacOS.

%prep
%setup -q -n %{name}-%{version}

%build
rm -rf %{buildroot}
./configure --prefix=%{buildroot}/usr --sysconfdir=%{buildroot}/etc/rvc
make

%install
make install
rm -rf %{buildroot}/usr/include
rm -rf %{buildroot}/usr/var

mkdir -p %{buildroot}/%{_unitdir}
install -p -m 644 %{SOURCE2} %{buildroot}/%{_unitdir}

%files
%defattr(-,root,root,-)
%config(noreplace) %{rvc_confdir}/rvd.conf
%attr(0600, root, root) %{rvc_confdir}/rvd.conf
%attr(0644, root, root) %{_unitdir}/rvd.service
%{_sbindir}/rvd
%{_bindir}/%{name}

%clean
rm -rf %{buildroot}

%post
mkdir -p %{rvc_confdir}/vpn.d
mkdir -p %{_localstatedir}/log/rvd
%systemd_post rvd.service

%preun
%systemd_preun rvd.service

%postun
%systemd_postun_with_restart rvd.service
rm -rf %{_localstatedir}/log/rvd

%changelog
* Sun Oct 01 2017 Jin JinRu <jin.jinru840430@gmail.com> - 0.9.0
- Added first version of rvc
